<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Public Document Database</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // アイコンコンポーネントの簡易実装
        const Icon = ({ name, size = 18, className = "" }) => {
            useEffect(() => {
                lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const App = () => {
            const [docs, setDocs] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [selectedRegion, setSelectedRegion] = useState('All');

            // --- 設定項目 (あなたのアカウント名に合わせてください) ---
            const GITHUB_USER = 'Girustar-bot'; 
            const REPO_NAME = 'Document-Data-Base';
            const DATA_URL = `https://raw.githubusercontent.com/${GITHUB_USER}/${REPO_NAME}/main/data/current/global-index.json`;

            useEffect(() => {
                const fetchData = async () => {
                    try {
                        setLoading(true);
                        const response = await fetch(DATA_URL);
                        if (!response.ok) throw new Error('データが見つかりません。Actionsが完了しているか確認してください。');
                        const data = await response.json();
                        setDocs(data);
                    } catch (err) {
                        setError(err.message);
                        // サンプルデータ
                        setDocs([
                            { title: "サンプル: 緊急事態管理政策 (JP)", country_code: "jp", region: "asia", date: "2026-02-10", status_level: "Critical", url: "#", summary: "GitHub Actionsが成功すると、ここに実際のデータが表示されます。" },
                            { title: "Sample: Federal Register Update (US)", country_code: "us", region: "americas", date: "2026-02-09", status_level: "Warning", url: "#", summary: "Data will appear here once the workflow finishes." }
                        ]);
                    } finally {
                        setLoading(false);
                        setTimeout(() => lucide.createIcons(), 100);
                    }
                };
                fetchData();
            }, []);

            const filteredDocs = useMemo(() => {
                return docs.filter(doc => {
                    const matchesSearch = (doc.title?.toLowerCase() || "").includes(searchTerm.toLowerCase()) || 
                                         (doc.country_code?.toLowerCase() || "").includes(searchTerm.toLowerCase());
                    const matchesRegion = selectedRegion === 'All' || doc.region === selectedRegion;
                    return matchesSearch && matchesRegion;
                });
            }, [docs, searchTerm, selectedRegion]);

            const regions = useMemo(() => ['All', ...new Set(docs.map(d => d.region).filter(Boolean))], [docs]);

            const getStatusColor = (level) => {
                switch (level) {
                    case 'Critical': return 'bg-red-100 text-red-800 border-red-200';
                    case 'Warning': return 'bg-yellow-100 text-yellow-800 border-yellow-200';
                    case 'Notice': return 'bg-blue-100 text-blue-800 border-blue-200';
                    default: return 'bg-gray-100 text-gray-800 border-gray-200';
                }
            };

            return (
                <div className="min-h-screen">
                    <header className="bg-white border-b sticky top-0 z-10">
                        <div className="max-w-6xl mx-auto px-4 py-4 flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <div className="flex items-center gap-2">
                                <div className="bg-indigo-600 p-2 rounded-lg text-white">
                                    <Icon name="globe" size={24} />
                                </div>
                                <h1 className="text-xl font-bold tracking-tight text-slate-800">Global Doc Database</h1>
                            </div>
                            <div className="relative flex-1 max-w-md">
                                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                                    <Icon name="search" size={18} />
                                </div>
                                <input 
                                    type="text"
                                    placeholder="タイトルや国で検索..."
                                    className="w-full pl-10 pr-4 py-2 border border-slate-200 rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-slate-50"
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                            </div>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto px-4 py-8">
                        <div className="flex items-center gap-4 mb-8 overflow-x-auto pb-2">
                            <Icon name="filter" size={18} className="text-slate-500 shrink-0" />
                            {regions.map(region => (
                                <button
                                    key={region}
                                    onClick={() => setSelectedRegion(region)}
                                    className={`px-4 py-1.5 rounded-full text-sm font-medium transition-all whitespace-nowrap ${
                                        selectedRegion === region 
                                        ? 'bg-indigo-600 text-white shadow-md' 
                                        : 'bg-white border border-slate-200 text-slate-600 hover:bg-slate-100'
                                    }`}
                                >
                                    {region.charAt(0).toUpperCase() + region.slice(1)}
                                </button>
                            ))}
                        </div>

                        {error && (
                            <div className="bg-amber-50 border border-amber-200 text-amber-800 p-4 rounded-xl mb-8 flex items-start gap-3">
                                <Icon name="alert-triangle" className="shrink-0 mt-0.5" />
                                <div>
                                    <p className="font-semibold text-sm">ヒント: データがまだ生成されていません</p>
                                    <p className="text-xs opacity-90">GitHubのActionsタブでワークフローを手動実行してください。</p>
                                </div>
                            </div>
                        )}

                        {loading ? (
                            <div className="flex flex-col items-center justify-center py-20 gap-4">
                                <div className="w-10 h-10 border-4 border-slate-200 border-t-indigo-600 rounded-full animate-spin"></div>
                                <p className="text-slate-500">データを読み込み中...</p>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {filteredDocs.map((doc, idx) => (
                                    <div key={idx} className="bg-white rounded-2xl border border-slate-200 shadow-sm hover:shadow-md transition-all flex flex-col group">
                                        <div className="p-5 flex-1">
                                            <div className="flex justify-between items-start mb-3">
                                                <span className="text-[10px] font-black uppercase tracking-widest text-indigo-600 bg-indigo-50 px-2 py-1 rounded">
                                                    {doc.country_code} / {doc.region}
                                                </span>
                                                <div className={`px-2 py-0.5 rounded text-[10px] font-bold border ${getStatusColor(doc.status_level)}`}>
                                                    {doc.status_level}
                                                </div>
                                            </div>
                                            <h3 className="font-bold text-slate-800 leading-snug mb-2 line-clamp-2 group-hover:text-indigo-600">
                                                {doc.title}
                                            </h3>
                                            <p className="text-slate-500 text-xs line-clamp-3 leading-relaxed">
                                                {doc.summary}
                                            </p>
                                        </div>
                                        <div className="px-5 py-3 border-t bg-slate-50 flex items-center justify-between">
                                            <div className="flex items-center gap-1 text-slate-400 text-[10px]">
                                                <Icon name="clock" size={12} />
                                                {doc.date}
                                            </div>
                                            <a href={doc.url} target="_blank" className="text-indigo-600 font-bold text-xs flex items-center gap-1 hover:underline">
                                                資料を開く <Icon name="external-link" size={12} />
                                            </a>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
